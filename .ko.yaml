---
defaultBaseImage: gcr.io/distroless/static-debian12:nonroot
baseImageOverrides:
  github.com/sigstore/scaffolding/tools/cloudsqlproxy/cmd/cloudsqlproxy: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.19.0-alpine

builds:
  - id: ctlog-createctconfig
    dir: ./tools/ctlog/
    main: ./cmd/ctlog/createctconfig
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
      - -tags
      - nostackdriver
    ldflags:
      - -s
      - -w
      - -extldflags "-static"
      - "{{ .Env.LDFLAGS }}"

  - id: ctlog-managectroots
    dir: ./tools/ctlog/
    main: ./cmd/ctlog/managectroots
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
      - -tags
      - nostackdriver
    ldflags:
      - -s
      - -w
      - -extldflags "-static"
      - "{{ .Env.LDFLAGS }}"

  - id: ctlog-verifyfulcio
    dir: ./tools/ctlog/
    main: ./cmd/ctlog/verifyfulcio
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
      - -tags
      - nostackdriver
    ldflags:
      - -s
      - -w
      - -extldflags "-static"
      - "{{ .Env.LDFLAGS }}"

  - id: fulcio-createcerts
    dir: ./tools/fulcio/
    main: ./cmd/fulcio/createcerts
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
      - -tags
      - nostackdriver
    ldflags:
      - -s
      - -w
      - -extldflags "-static"
      - "{{ .Env.LDFLAGS }}"

  - id: tuf-createsecret
    dir: ./tools/tuf/
    main: ./cmd/tuf/createsecret
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
      - -tags
      - nostackdriver
    ldflags:
      - -s
      - -w
      - -extldflags "-static"
      - "{{ .Env.LDFLAGS }}"

  - id: tuf-server
    dir: ./tools/tuf/
    main: ./cmd/tuf/server
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
      - -tags
      - nostackdriver
    ldflags:
      - -s
      - -w
      - -extldflags "-static"
      - "{{ .Env.LDFLAGS }}"

  - id: trillian-createtree
    dir: ./tools/trillian/
    main: ./cmd/trillian/createtree
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
      - -tags
      - nostackdriver
    ldflags:
      - -s
      - -w
      - -extldflags "-static"
      - "{{ .Env.LDFLAGS }}"

  - id: trillian-createdb
    dir: ./tools/trillian/
    main: ./cmd/trillian/createdb
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
      - -tags
      - nostackdriver
    ldflags:
      - -s
      - -w
      - -extldflags "-static"
      - "{{ .Env.LDFLAGS }}"

  - id: trillian-updatetree
    dir: ./tools/trillian/
    main: ./cmd/trillian/updatetree
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
      - -tags
      - nostackdriver
    ldflags:
      - -s
      - -w
      - -extldflags "-static"
      - "{{ .Env.LDFLAGS }}"

  - id: cloudsqlproxy
    dir: ./tools/cloudsqlproxy/
    main: ./cmd/cloudsqlproxy
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
      - -tags
      - nostackdriver
    ldflags:
      - -s
      - -w
      - -extldflags "-static"
      - "{{ .Env.LDFLAGS }}"

  - id: getoidctoken
    dir: ./tools/getoidctoken/
    main: ./cmd/getoidctoken
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
      - -tags
      - nostackdriver
    ldflags:
      - -s
      - -w
      - -extldflags "-static"
      - "{{ .Env.LDFLAGS }}"

  - id: prober
    dir: ./tools/prober/
    main: ./cmd/prober
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
      - -tags
      - nostackdriver
    ldflags:
      - -s
      - -w
      - -extldflags "-static"
      - "{{ .Env.LDFLAGS }}"

  - id: rekor-createsecret
    dir: ./tools/rekor/
    main: ./cmd/rekor/rekor-createsecret
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
      - -tags
      - nostackdriver
    ldflags:
      - -s
      - -w
      - -extldflags "-static"
      - "{{ .Env.LDFLAGS }}"
